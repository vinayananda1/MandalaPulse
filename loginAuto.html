<!DOCTYPE html>
<html>
<head>
  <title>MandalaPulse Auto Login</title>
</head>
<body>
  <h2>🌼 MandalaPulse Auto Login Ritual</h2>
  <p id="status">🔍 Preparing invocation…</p>

  <script>
    // 🌼 Extract user parameter from URL
    const urlParams = new URLSearchParams(window.location.search);
    const email = urlParams.get("user");
    const password = "auto"; // symbolic password

    if (email) {
      document.getElementById("status").innerText = `🔐 Validating ${email}…`;

      // ⏳ Fallback message if backend is slow or unreachable
      setTimeout(() => {
        document.getElementById("status").innerText += "\n⏳ Still waiting… If nothing happens, backend may be unreachable.";
      }, 3000);

      // 🧘 Invoke backend validation
      google.script.run.withSuccessHandler(function(response) {
        if (response.status === "✅") {
          const role = response.role;
          const username = response.name;
          const code = Date.now(); // symbolic invocation code

          document.getElementById("status").innerText = `✅ Welcome ${username} (${role}) — redirecting…`;

          // 🌐 Redirect to admin.html with lineage
          window.location.href = `admin.html?username=${username}&role=${role}&code=${code}`;
        } else {
          document.getElementById("status").innerText = `🛑 Auto-login failed: ${response.status}`;
        }
      }).validate(email, password);
    } else {
      document.getElementById("status").innerText = "🛑 No user parameter found in URL";
    }
  </script>
</body>
</html>
