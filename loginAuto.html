<!DOCTYPE html>
<html>
<head>
  <title>MandalaPulse Auto Login</title>
</head>
<body>
  <h2>ğŸŒ¼ MandalaPulse Auto Login Ritual</h2>
  <p id="status">ğŸ” Preparing invocationâ€¦</p>

  <script>
    // ğŸŒ¼ Extract user parameter from URL
    const urlParams = new URLSearchParams(window.location.search);
    const email = urlParams.get("user");
    const password = "auto"; // symbolic password

    if (email) {
      document.getElementById("status").innerText = `ğŸ” Validating ${email}â€¦`;

      // â³ Fallback message if backend is slow or unreachable
      setTimeout(() => {
        document.getElementById("status").innerText += "\nâ³ Still waitingâ€¦ If nothing happens, backend may be unreachable.";
      }, 3000);

      // ğŸ§˜ Invoke backend validation
      google.script.run.withSuccessHandler(function(response) {
        if (response.status === "âœ…") {
          const role = response.role;
          const username = response.name;
          const code = Date.now(); // symbolic invocation code

          document.getElementById("status").innerText = `âœ… Welcome ${username} (${role}) â€” redirectingâ€¦`;

          // ğŸŒ Redirect to admin.html with lineage
          window.location.href = `admin.html?username=${username}&role=${role}&code=${code}`;
        } else {
          document.getElementById("status").innerText = `ğŸ›‘ Auto-login failed: ${response.status}`;
        }
      }).validate(email, password);
    } else {
      document.getElementById("status").innerText = "ğŸ›‘ No user parameter found in URL";
    }
  </script>
</body>
</html>
